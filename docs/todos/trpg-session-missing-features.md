# TRPGセッション画面 - 未実装機能 Todoリスト

現在のTRPGセッション画面の実装状況を分析し、フロー文書と照らし合わせて足りない実装をまとめました。

## 🔴 Critical Priority - 中核システム

### 1. ✅ WebSocket仲間自律行動システム (完了)
- [x] WebSocket接続の基盤実装 (Socket.IO)
- [x] サーバー側状況分析エンジン
- [x] 仲間キャラクター反応判定ロジック
- [x] リアルタイムメッセージプッシュ機能
- [x] 仲間AI個性別反応生成
- [x] WebSocketフォールバック機能

### 2. ✅ パワーチェック・ミニゲーム (完了)
- [x] パワーチェックUIコンポーネント作成
- [x] 強行突破系チェック判定ロジック
- [x] プログレスバー型チェック実装
- [x] タイミングゲーム要素
- [x] パワーチェック結果処理

### 3. ✅ スキルチェック・ミニゲーム (完了)
- [x] スキルチェックUIコンポーネント作成
- [x] 技能別チェック種別実装
- [x] インタラクティブスキルチャレンジ
- [x] タイミング・精度要求ゲーム
- [x] スキルチェック結果処理

## 🟡 High Priority - ゲーム進行管理

### 4. ✅ クエスト管理システム (完了)
- [x] クエスト管理画面UI作成
- [x] メインクエスト・サブクエスト分類
- [x] クエスト進行状況トラッキング
- [x] クエスト目標達成判定
- [x] クエスト選択・実行フロー
- [x] クエスト完了報酬システム

### 5. ✅ マイルストーン・進捗管理 (完了)
- [x] マイルストーン管理コンポーネント (UI完了)
- [x] バックエンドマイルストーンサービス
- [x] マイルストーンAPI routes
- [x] フロントエンドAPI クライアント
- [x] SessionInterface統合

### 6. ✅ ターン・時間管理システム (完了)
- [x] ターン制管理ロジック（戦闘外）
- [x] 1日の行動回数制限実装
- [x] 日付進行システム
- [x] 時間経過による状態変化
- [x] 最終日判定・ゲーム終了条件
- [x] バックエンドサービス (timeManagementService.ts)
- [x] API routes (/api/time-management)
- [x] フロントエンドAPIクライアント
- [x] TimeManagementPanel UI コンポーネント

## 🟢 Medium Priority - AIゲームマスター強化

### 7. ✅ アプローチ・難易度判定システム (完了)
- [x] プレイヤーアプローチ解析 (AI分析エンジン)
- [x] AI難易度動的調整 (修正要因システム)
- [x] アプローチ論理性評価 (創造性・論理性・適切性・実現可能性)
- [x] チェック種別自動判定 (skill/power/combat/special/narrative)
- [x] リトライ機能（難易度低下）
- [x] バックエンドサービス (approachAnalysisService.ts)
- [x] API routes (/api/approach-analysis)
- [x] フロントエンドAPIクライアント
- [x] ApproachAnalysisPanel UI コンポーネント

### 8. ✅ AIゲームマスター強化システム (完了)
- [x] セッション開始時のゲーム概要生成
- [x] タスク内容説明生成
- [x] 結果判定・フィードバック生成
- [x] 動的シナリオ調整
- [x] 状況に応じた演出生成
- [x] バックエンドサービス (aiGameMasterService.ts)
- [x] API routes (/api/ai-game-master)
- [x] フロントエンドAPIクライアント
- [x] AIGameMasterPanel UI コンポーネント
- [x] SessionInterface統合

### 9. 仲間キャラクター個性システム
- [ ] 戦士反応パターン
- [ ] 魔法使い反応パターン
- [ ] 盗賊専用反応パターン
- [ ] キャラクターの性格を考慮して反応パターンと会話タイミングを調整
- [ ] 状況適応反応（成功/失敗連続時など）
- [ ] 自然な会話タイミング調整

## 🔵 Low Priority - ユーザビリティ向上

### 10. 行動選択UI改善
- [ ] 探索行動選択インターフェース
- [ ] 拠点行動選択インターフェース
- [ ] 仲間との交流インターフェース
- [ ] 場所移動選択インターフェース
- [ ] 行動選択時のヒント表示

### 11. 結果処理・報酬システム
- [ ] アイテム獲得システム
- [ ] 報酬表示・管理UI
- [ ] 失敗時ペナルティ処理
- [ ] 成功時ボーナス表示
- [ ] 結果アニメーション

### 12. セッション管理機能
- [ ] セッション状態保存・復元
- [ ] セッション履歴管理
- [ ] セッション統計・レポート
- [ ] エクスポート・インポート機能

## 🔴 New Critical Priority - マイルストーン生成・プールシステム

### 13. AIマイルストーン生成・管理システム
- [ ] AIによる初回マイルストーン生成（基本3個程度）
- [ ] マイルストーンタイプ別生成ロジック
  - [ ] 特定のエネミーを倒す
  - [ ] 特定のイベントをクリア
  - [ ] 特定のNPCとの特定のコミュニケーションの実施
  - [ ] キーアイテムの取得
  - [ ] クエストクリア
- [ ] バッチ処理による順次マイルストーン実行
- [ ] テーマ適応システム（ほのぼの日常ではエネミー無効化など）

### 14. エンティティプールシステム
- [ ] エネミープール生成・管理
  - [ ] テーマ別エネミー生成
  - [ ] 場所別エネミー配置
  - [ ] エネミー能力・報酬設定
- [ ] イベントプール生成・管理
  - [ ] テーマ別イベント生成
  - [ ] 場所別イベント配置
  - [ ] 複数選択肢設定
- [ ] NPCプール生成・管理
  - [ ] テーマ別NPC生成
  - [ ] NPC個性・対話パターン設定
  - [ ] コミュニケーション条件設定
- [ ] アイテムプール生成・管理
  - [ ] 入手方法の複数ソース対応
  - [ ] アイテム効果・価値設定
- [ ] クエストプール生成・管理
  - [ ] テーマ別クエスト生成
  - [ ] クエスト達成条件設定

### 15. インタラクティブイベントシステム
- [ ] イベント行動選択肢システム
  - [ ] 複数選択肢の動的生成
  - [ ] 選択肢別の結果分岐
- [ ] ゲームマスター問いかけシステム
  - [ ] 「どのようにタスクをクリアしますか？」AI対話
  - [ ] クリア方針の自然言語理解
- [ ] AI難易度判定・ダイスチェック連携
  - [ ] プレイヤー方針に基づく難易度算出
  - [ ] 既存ダイスチェックUIとの統合
  - [ ] 成功・失敗判定とGM解説生成
- [ ] リトライシステム
  - [ ] リトライ回数管理
  - [ ] 段階的難易度低下ロジック
  - [ ] リトライ時のフィードバック変化

### 16. 開発者モード管理画面
- [ ] エネミー管理画面
  - [ ] エネミー一覧・編集・削除
  - [ ] エネミー能力値編集
  - [ ] 場所別配置設定
- [ ] イベント管理画面
  - [ ] イベント内容編集
  - [ ] 選択肢・結果編集
  - [ ] 場所別配置設定
- [ ] NPC管理画面
  - [ ] NPC情報・個性編集
  - [ ] 対話パターン編集
  - [ ] コミュニケーション条件設定
- [ ] アイテム管理画面
  - [ ] アイテム効果・説明編集
  - [ ] 入手方法設定
  - [ ] 希少度・価値設定
- [ ] マイルストーン管理画面
  - [ ] マイルストーン内容編集
  - [ ] 達成条件詳細設定
  - [ ] 進捗状況監視

### 17. フィードバック・報酬システム
- [ ] マイルストーン外活動フィードバック
  - [ ] プール内エネミー討伐時の良いフィードバック
  - [ ] プール内イベント実施時の体験向上
  - [ ] NPCとの自由対話時の評価
- [ ] 場所連携システム
  - [ ] イベント・エネミーの場所紐付け
  - [ ] 場所別コンテンツ表示
  - [ ] 移動時のコンテンツ発見

## 📋 実装優先度の理由

### Critical Priority
- **WebSocket仲間自律システム**: フロー図の中核機能で、リアルタイム性が重要
- **パワー・スキルチェック**: ゲームプレイの根幹部分で必須

### High Priority  
- **クエスト・マイルストーン**: ゲーム進行に直結する重要システム
- **ターン・時間管理**: TRPGセッションの構造的要素

### Medium Priority
- **AI強化**: ユーザー体験向上に重要だが基本機能は動作可能

### Low Priority
- **UI改善・管理機能**: 基本機能があれば最低限のプレイは可能

## 🔧 技術的考慮事項

1. **WebSocket実装**: Socket.IOを使用してサーバー側との安定したリアルタイム通信
2. **型安全性**: packages/types の既存型定義を活用
3. **コンポーネント設計**: 既存のDiceRollUI等の実装パターンを参考
4. **AI統合**: 既存のAIControlPanelの実装パターンを拡張
5. **状態管理**: useSessionフックを拡張してゲーム状態管理

## 📅 作成日時
2025-06-19

## 📝 備考
この文書は `/home/irure/AIAgentTRPGGM2/docs/機能要件定義/TRPGセッション_フロー.md` の要件と現在の実装を比較して作成されました。実装進捗に応じて定期的に更新してください。