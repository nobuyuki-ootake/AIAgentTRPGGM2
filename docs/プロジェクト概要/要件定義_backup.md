# AIAgentTRPGGM プロジェクト要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
AIAgentTRPGGM（AI Agent TRPG Game Master）

### 1.2 プロジェクトの目的
AI を活用した TRPG（テーブルトーク RPG）キャンペーン管理およびゲームマスター支援ツールの開発。ゲームマスターが効率的かつ創造的に TRPG キャンペーンを作成・運営できるよう包括的な支援機能を提供する。

### 1.3 対象ユーザー
- **主要ユーザー**: TRPG ゲームマスター（初心者〜上級者）
- **副次ユーザー**: TRPG プレイヤー（セッション参加時）
- **想定規模**: 50〜1,000 同時ユーザー

### 1.4 システム概要
- **アーキテクチャ**: モノレポ構成のフルスタック Web アプリケーション
- **フロントエンド**: React 18 + Material UI + Recoil
- **バックエンド**: Express.js + TypeScript + Litestream
- **AI 統合**: OpenAI, Anthropic, Google の複数プロバイダー対応

## 2. 機能要件

### 2.1 ホームページ機能

#### 2.1.1 キャンペーン管理
- **キャンペーン一覧表示**: 作成済みキャンペーンの視覚的一覧
- **キャンペーン作成**: ステップバイステップの作成ウィザード
- **キャンペーン操作**: 選択・削除・複製・インポート/エクスポート
- **AI 支援**: キャンペーン作成時の AI アシスタンス

#### 2.1.2 クイックアクション
- **最近のキャンペーン**: 直近使用キャンペーンへの素早いアクセス
- **テンプレート機能**: 事前定義キャンペーンテンプレート
- **テストデータ**: 学習用サンプルデータの読み込み

### 2.2 キャンペーン設定機能

#### 2.2.1 基本情報設定
- **キャンペーン基本情報**: 名前・ゲームシステム・概要・期間
- **プレイヤー構成**: 人数・経験レベル・プレイスタイル
- **世界設定基盤**: テーマ・規模・技術レベル・魔法レベル
- **キャンペーン目標**: メインクエスト・サブクエスト・成長目標

#### 2.2.2 段階的設定ウィザード
- **Step 1**: 基本情報（名前・システム・テーマ）
- **Step 2**: プレイヤー設定（人数・経験・スタイル）
- **Step 3**: 世界設定（世界観・技術・魔法）
- **Step 4**: 目標設定（ストーリー・期間・達成目標）
- **Step 5**: 確認・作成（設定確認・AI 評価・作成実行）

#### 2.2.3 AI 統合支援
- **設定アシスタント**: テーマ提案・バランスチェック・難易度調整
- **自動生成支援**: 世界設定・NPC 候補・イベントシード生成
- **バランス評価**: 構成分析・実現可能性・改善提案

### 2.3 キャラクター管理機能

#### 2.3.1 キャラクター種別管理
- **PC（プレイヤーキャラクター）**: メインキャラクターの包括管理
- **NPC（ノンプレイヤーキャラクター）**: ストーリー重要キャラクター
- **Enemy（敵キャラクター）**: 戦闘・コンフリクト対象キャラクター

#### 2.3.2 キャラクター基本機能
- **基本データ**: 名前・年齢・種族・職業・レベル・経験値
- **能力値**: 基本能力値・派生能力値・スキル・特技
- **外見設定**: 物理特徴・性格・背景・画像・アバター
- **キャラクターシート**: フル表示・クイックリファレンス・編集モード

#### 2.3.3 PC 固有機能
- **キャラクター作成**: ガイド付き作成・ランダム生成・テンプレート
- **成長管理**: レベルアップ・装備管理・習得履歴
- **パーティバランス**: 構成分析・役割分担・推奨構成

#### 2.3.4 NPC 固有機能
- **ストーリー統合**: 関係性マップ・重要度設定・登場頻度
- **AI 行動パターン**: 性格設定・目標動機・反応パターン
- **動的進化**: 関係性変化・状況適応・記憶システム

#### 2.3.5 Enemy 固有機能
- **戦闘データ**: 戦闘能力・特殊能力・戦術 AI
- **遭遇管理**: 出現条件・難易度調整・戦利品
- **バリエーション**: 雑魚敵・精鋭敵・ボス敵管理

### 2.4 タイムライン管理機能

#### 2.4.1 タイムライン表示
- **時系列ビュー**: イベントの時間軸表示
- **階層構造**: メインクエスト→サブクエスト→イベント
- **フィルタリング**: 種別・重要度・状態による絞り込み
- **ズーム機能**: 日単位から年単位の表示切り替え

#### 2.4.2 イベント管理
- **イベント作成・編集**: 新規追加・既存修正
- **イベント種別**: メイン・サブ・日常・戦闘・社交・探索
- **クエスト統合**: 階層管理・進行状況・依存関係・報酬

#### 2.4.3 セッション計画
- **セッション構成**: 1 セッション内のイベント配置
- **時間配分**: 各イベントの想定時間
- **難易度調整**: セッション全体のバランス
- **準備項目**: GM 準備素材の管理

#### 2.4.4 AI 統合機能
- **イベント生成支援**: 自動提案・関連イベント・バランス調整
- **セッション最適化**: 時間見積・難易度評価・流れ最適化
- **動的調整**: プレイヤー反応分析・興味分析・展開予測

#### 2.4.5 イベントシード機能
- **シード管理**: 将来候補・優先度・カテゴリ・使用状況
- **シード生成**: AI 自動生成・手動追加・インポート
- **シード展開**: 詳細化・関連付け・スケジューリング

### 2.5 TRPG セッション機能

#### 2.5.1 セッション管理
- **セッション状態**: 開始・進行中・休憩・終了の状態制御
- **参加者管理**: プレイヤーとキャラクターの対応
- **セッション履歴**: 過去セッションの記録・参照

#### 2.5.2 キャラクター表示・管理
- **パーティ表示**: 参加キャラクターの一覧表示
- **リアルタイム更新**: HP・MP 等のリアルタイム変更
- **状態管理**: 毒・麻痺等の状態異常管理

#### 2.5.3 チャットインターフェース
- **メッセージ交換**: GM・プレイヤー間コミュニケーション
- **ロール分け**: IC・OOC の区別
- **システムメッセージ**: ダイスロール結果・通知
- **ログ保存**: セッション内容の自動記録

#### 2.5.4 ダイスシステム
- **基本ダイス**: D4〜D100 の各種ダイス対応
- **複数ダイス**: 複数個同時ロール・修正値適用
- **スキルチェック**: 自動計算・難易度設定・成功失敗判定
- **戦闘サポート**: 攻撃ロール・ダメージロール・イニシアチブ

#### 2.5.5 インタラクションパネル
- **クイックアクション**: よく使用する行動のボタン化
- **スキル使用**: スキル・魔法・特技の実行
- **アイテム使用**: 所持アイテムの使用・管理
- **環境インタラクション**: 場所・オブジェクトとの相互作用

#### 2.5.6 AI 統合機能
- **GM アシスタント**: ルール参照・裁定支援・バランス調整・時間管理
- **NPC 制御**: AI 行動・感情シミュレーション・記憶機能・関係性反映
- **動的イベント生成**: 状況対応・興味分析・緊張管理

#### 2.5.7 セッションモード
- **探索モード**: マップ表示・移動管理・発見システム・環境情報
- **戦闘モード**: 戦闘マップ・行動順管理・アクション管理・効果範囲
- **社交モード**: NPC 対話・判定サポート・関係性表示・情報管理

### 2.6 AI 統合機能

#### 2.6.1 AI アーキテクチャ
- **マルチプロバイダー対応**: OpenAI・Anthropic・Google・カスタム
- **統一インターフェース**: 共通 API エンドポイント・標準化リクエスト
- **コンテキスト管理**: セッション継続・選択要素パターン・最適化

#### 2.6.2 AI 支援機能カテゴリ
- **キャンペーン作成支援**: 世界観生成・バランス分析・整合性チェック
- **キャラクター生成管理**: PC 生成支援・NPC 自動生成・敵キャラ調整
- **ストーリーイベント生成**: イベント自動生成・ストーリー展開支援
- **セッション運営支援**: リアルタイム GM 支援・動的コンテンツ生成

#### 2.6.3 AI ペルソナ管理
- **システムプロンプト**: GM アシスタント・ワールドビルダー・バランサー・ストーリーテラー
- **専門化 AI**: 戦闘・社交・探索・成長特化 AI
- **文脈適応**: ゲームシステム対応・キャンペーン文脈・プレイヤー適応

## 3. 非機能要件

### 3.1 パフォーマンス要件

#### 3.1.1 応答時間要件
- **ページ表示速度**: 初回読み込み 3 秒以内・ページ遷移 1 秒以内
- **AI 機能応答**: チャット応答 10 秒以内・生成機能 15 秒以内
- **リアルタイム機能**: セッション状態更新 100ms 以内

#### 3.1.2 スループット要件
- **同時ユーザー数**: 開発環境 5 ユーザー・本番環境 50 ユーザー
- **セッション同時実行**: 10 セッション
- **API リクエスト処理**: REST API 100req/秒・AI API 10req/秒

#### 3.1.3 リソース使用量
- **フロントエンドメモリ**: ブラウザメモリ 512MB 以内
- **バックエンドメモリ**: プロセスメモリ 1GB 以内
- **CPU 使用率**: 通常操作 30%以下・AI 処理中 70%以下

### 3.2 セキュリティ要件

#### 3.2.1 データ保護
- **個人情報保護**: データ分類・匿名化・削除権・最小限収集
- **ローカルデータ保護**: 暗号化保存・セッション管理・CSP 実装
- **伝送データ保護**: HTTPS 通信・API 通信暗号化・改ざん検出

#### 3.2.2 AI セキュリティ
- **API キー保護**: フロント露出防止・伝送暗号化・ログ除外
- **プロンプトインジェクション対策**: 入力検証・サニタイゼーション・プロンプト分離
- **データ流出防止**: 機密情報フィルタ・ローカル処理・データ匿名化

#### 3.2.3 コンテンツセキュリティ
- **不適切コンテンツ対策**: フィルタ・年齢制限・ユーザー報告
- **知的財産保護**: 著作権遵守・ライセンス管理・オリジナリティ

### 3.3 ユーザビリティ要件

#### 3.3.1 学習性要件
- **新規ユーザー**: 30 分以内で基本操作習得
- **機能習得時間**: キャンペーン作成 15 分・キャラ作成 10 分・セッション開始 20 分
- **習得支援**: チュートリアル・サンプルデータ・ヘルプシステム

#### 3.3.2 効率性要件
- **操作効率**: キーボードショートカット・直感的操作・一括操作
- **ナビゲーション効率**: 最小クリック・パンくずナビ・検索機能
- **データ入力効率**: 自動補完・テンプレート・インポート機能

#### 3.3.3 アクセシビリティ要件
- **視覚的**: 色覚対応・WCAG 2.1 AA 準拠・フォントサイズ調整
- **聴覚的**: 視覚的情報・字幕機能・視覚的アラート
- **運動機能**: キーボードナビゲーション・大きなクリック領域
- **認知的**: 明確な言語・一貫性・エラー防止・回復支援

### 3.4 信頼性要件

#### 3.4.1 可用性要件
- **システム稼働率**: ローカル使用 99.9%・AI 機能 95%
- **障害復旧時間**: 軽微障害 1 時間・中程度 4 時間・重大 24 時間
- **計画停止時間**: 月 1 回 2 時間以内

#### 3.4.2 耐障害性要件
- **ローカル障害対応**: 代替ストレージ・グレースフルデグラデーション・自動再起動
- **ネットワーク障害対応**: オフライン継続・代替プロバイダー・ローカル継続
- **データ障害対応**: 自動バックアップ復旧・トランザクションロールバック

#### 3.4.3 データ整合性要件
- **ACID 特性**: 原子性・一貫性・独立性・永続性の確保
- **データ検証**: リアルタイム検証・制約チェック・参照整合性
- **バックアップ復旧**: 自動バックアップ・増分バックアップ・復旧テスト

### 3.5 スケーラビリティ要件

#### 3.5.1 水平スケーラビリティ
- **ユーザー数拡張**: 現在 50 → 短期 200 → 中期 1,000 → 長期 10,000
- **セッション拡張**: 現在 10 → 短期 50 → 中期 200 → 長期 1,000
- **地理的拡張**: 日本 → アジア太平洋 → 北米欧州 → 全世界

#### 3.5.2 垂直スケーラビリティ
- **データ容量拡張**: キャンペーン 100MB→1GB→10GB
- **処理能力拡張**: CPU 150%・メモリ 200%・ストレージ I/O 300%
- **機能複雑性拡張**: AI 機能 10 倍・キャラクター 1,000 体・イベント 10,000 件

#### 3.5.3 AI 機能スケーラビリティ
- **AI リクエスト処理**: 並列処理・キューイング・バッチ処理・キャッシュ
- **AI プロバイダー拡張**: プロバイダー追加・負荷分散・コスト最適化
- **AI モデル管理**: モデル更新・A/B テスト・個別最適化

### 3.6 保守性要件

#### 3.6.1 コード品質要件
- **可読性理解性**: 一貫したスタイル・分かりやすい命名・適切コメント
- **モジュール性**: 単一責任・疎結合・高凝集・明確インターフェース
- **再利用性**: 再利用可能コンポーネント・ライブラリ化・設定外部化

#### 3.6.2 技術的負債管理
- **負債測定監視**: コード複雑度・重複コード・技術的負債比率
- **負債削減**: リファクタリング計画・レガシーコード対応・ライブラリ更新
- **負債予防**: コードレビュー・静的解析・設計パターン・CI

#### 3.6.3 ドキュメント管理
- **技術ドキュメント**: API 文書・アーキテクチャ文書・運用手順書
- **ユーザードキュメント**: マニュアル・FAQ・チュートリアル・リリースノート
- **ドキュメント品質**: 最新性・正確性・完全性・検索性

### 3.7 互換性要件

#### 3.7.1 ブラウザ互換性
- **対応ブラウザ**: Chrome 90+・Firefox 88+・Safari 14+・Edge 90+
- **モバイルブラウザ**: Chrome Mobile・Safari Mobile・Samsung Internet・Firefox Mobile
- **機能互換性**: ES2020・CSS Grid/Flexbox・WebRTC・WebGL

#### 3.7.2 デバイス互換性
- **画面サイズ対応**: デスクトップ 1920×1080+・ラップトップ 1366×768+・タブレット 1024×768+
- **入力デバイス対応**: マウスキーボード・タッチスクリーン・デジタルペン・音声入力
- **ハードウェア要件**: 最小 RAM 4GB・最小ストレージ 1GB・ネットワーク 1Mbps+

#### 3.7.3 外部システム互換性
- **AI プロバイダー**: OpenAI・Anthropic・Google・カスタムエンドポイント
- **クラウドサービス**: Google Cloud・AWS・Azure 対応準備
- **ファイル形式**: JSON・CSV・XML・YAML・PDF・PNG/JPEG

## 4. 技術要件

### 4.1 アーキテクチャ要件

#### 4.1.1 モノレポ構造
```
AIAgentTRPGGM/
├── apps/
│   ├── frontend/          # React 18 SPA
│   └── proxy-server/      # Express.js API
├── packages/
│   └── types/            # 共通型定義
└── docs/                 # ドキュメント
```

#### 4.1.2 技術スタック
- **フロントエンド**: React 18・Material UI・Recoil・React Router v7・Vite・TypeScript
- **バックエンド**: Express.js・TypeScript・Litestream・Mastra・Google Cloud Storage
- **AI 統合**: OpenAI・Anthropic・Google・カスタムエンドポイント

#### 4.1.3 重要パターン
- **AI 統合アーキテクチャ**: Frontend → `/api/ai-agent/*` → Proxy Server → AI Providers
- **状態管理フロー**: Recoil atoms・ローカル state・Litestream・Cloud Storage
- **画面ナビゲーション**: Home → Campaign Setup → Characters → World Building → Session Planning → TRPG Session

### 4.2 開発要件

#### 4.2.1 開発環境
- **統一安全起動**: `./start-dev.sh` スクリプト必須使用
- **ビルド**: `pnpm build`（Turbo 使用）
- **テスト**: Playwright E2E テスト・AI 強化テスト
- **品質**: `pnpm lint`・TypeScript strict モード

#### 4.2.2 型安全性
- **共通型定義**: `packages/types/index.ts`
- **テストデータ**: 本番と同じ型を使用・テストデータ用型定義禁止
- **any 型回避**: TypeScript 型システム最大活用

#### 4.2.3 エラーハンドリング
- **フォールバック禁止**: ユーザー解消可能エラーの明確提示
- **API キー保護**: フロント開示は重大インシデント
- **誠実な実装**: エラー隠蔽の禁止

### 4.3 品質要件

#### 4.3.1 テスト要件
- **TDD**: コアロジックは TDD で実装
- **UI 確認**: リアルタイム画面確認・browsermcp 検証
- **テストカバレッジ**: 80%以上のコードカバレッジ
- **data-testid**: 積極的設定・優先使用

#### 4.3.2 コンポーネント設計
- **単一責任原則**: 1 コンポーネント1 責任
- **ファイル分割**: 800 行程度で分割検討
- **UI ロジック分離**: 適切な分離と粒度

#### 4.3.3 ドキュメント要件
- **コミット前更新**: `docs/chat.md`・`docs/tasks.md`・`docs/tutorial.md`
- **チュートリアル**: プロンプト目的記載
- **README 更新**: 新ドキュメント追加時

## 5. 制約・前提条件

### 5.1 技術制約
- **学習プロジェクト**: バイブコーディング学習のための教育的プロジェクト
- **言語**: 文書と会話は日本語
- **後方互換**: 後方互換機能は不要（単体動作）
- **プロジェクト粒度**: 適切なファイル長・コンポーネント粒度

### 5.2 AI 制約
- **API キー管理**: ローカルストレージでの安全管理
- **プロバイダー制限**: 各プロバイダーのレート制限・利用規約遵守
- **コンテンツ安全性**: 不適切コンテンツの自動検出・除外

### 5.3 セキュリティ制約
- **個人情報**: 最小限収集・適切な管理・削除権保証
- **データ保護**: 暗号化・アクセス制御・監査ログ
- **コンプライアンス**: 関連法規制・業界標準の遵守

## 6. プロジェクト成功基準

### 6.1 機能成功基準
- **基本機能**: 全ての基本機能が仕様通り動作
- **AI 統合**: AI 機能が期待される品質で動作
- **ユーザビリティ**: 新規ユーザーが 30 分以内で基本操作習得

### 6.2 品質成功基準
- **パフォーマンス**: 全ての応答時間要件を満たす
- **セキュリティ**: セキュリティ監査で重大な問題なし
- **信頼性**: 99%以上の稼働率達成

### 6.3 技術成功基準
- **コード品質**: 技術的負債比率 20%以下
- **テストカバレッジ**: 80%以上達成
- **ドキュメント**: 全機能のドキュメント完備

## 7. リスクと対策

### 7.1 技術リスク
- **AI API 制限**: 複数プロバイダー対応・レート制限管理
- **パフォーマンス**: 継続的監視・最適化・スケーリング対応
- **セキュリティ**: 定期監査・脆弱性スキャン・インシデント対応

### 7.2 運用リスク
- **可用性**: 冗長化・バックアップ・災害復旧計画
- **データ損失**: 自動バックアップ・バージョン管理・復旧テスト
- **ユーザビリティ**: 継続的ユーザーテスト・フィードバック収集

### 7.3 ビジネスリスク
- **技術変化**: 新技術対応・標準進化への適応
- **規制変更**: コンプライアンス継続監視・迅速対応
- **競合**: 独自価値・継続改善・ユーザー満足度向上

---

この要件定義書は AIAgentTRPGGM プロジェクトの包括的な要件を定義し、開発・運用・保守の指針となる。すべての関係者はこの要件に基づいてプロジェクトを推進し、定期的に要件の見直しと更新を行う。