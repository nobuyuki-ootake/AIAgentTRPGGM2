# タイムライン管理機能要件定義

## 概要
TRPGキャンペーンにおけるイベント、クエスト、セッションの時系列管理と計画立案を行うページ。キャンペーンの進行管理と将来のセッション準備を支援する。

## 基本機能

### 1. タイムライン表示
- **時系列ビュー**: イベントの時間軸表示
- **階層構造**: メインクエスト → サブクエスト → イベントの階層
- **フィルタリング**: 種別・重要度・状態による絞り込み
- **ズーム機能**: 日単位から年単位までの表示切り替え

### 2. イベント管理
- **イベント作成**: 新規イベントの追加
- **イベント編集**: 既存イベントの修正
- **イベント種別**:
  - メインクエストイベント
  - サブクエストイベント
  - 日常イベント
  - 戦闘イベント
  - 社交イベント
  - 探索イベント

### 3. クエスト統合管理
- **クエスト階層**: 親子関係のクエスト管理
- **進行状況**: 各クエストの完了率
- **依存関係**: クエスト間の前提条件
- **報酬管理**: クエスト完了時の報酬設定

### 4. セッション計画
- **セッション構成**: 1セッション内のイベント配置
- **時間配分**: 各イベントの想定時間
- **難易度調整**: セッション全体の難易度バランス
- **準備項目**: GM が準備すべき素材の管理

## AI統合機能

### 1. イベント生成支援
- **自動提案**: キャンペーン設定に基づくイベント案
- **関連イベント**: 既存イベントに関連する展開提案
- **バランス調整**: 戦闘・探索・社交の適切な配分

### 2. セッション最適化
- **時間見積**: 各イベントの所要時間予測
- **難易度評価**: セッション全体の難易度分析
- **流れ最適化**: イベント順序の改善提案

### 3. 動的調整
- **プレイヤー反応分析**: 過去セッションの振り返り
- **興味分析**: プレイヤーの嗜好に基づく調整
- **展開予測**: 複数のシナリオ分岐予測

## イベントシード機能

### 1. シード管理
- **イベントシード**: 将来のイベント候補
- **優先度設定**: 使用優先度の管理
- **カテゴリ分類**: 種別・テーマによる分類
- **使用状況**: シードの使用・未使用追跡

### 2. シード生成
- **AI自動生成**: 世界設定に基づく自動作成
- **手動追加**: GM による独自シード追加
- **インポート**: 外部リソースからの取り込み

### 3. シード展開
- **詳細化**: シードから具体的イベントへの展開
- **関連付け**: 既存イベントとの関連性設定
- **スケジューリング**: タイムラインへの配置

## 条件イベントシステム

### 1. 条件設定
- **発動条件**: イベント発生の前提条件
- **キャラクター条件**: 特定キャラクターの状態
- **アイテム条件**: 特定アイテムの所持
- **場所条件**: 特定場所での発生
- **時間条件**: 特定タイミングでの発生

### 2. 動的イベント
- **分岐イベント**: プレイヤー選択による分岐
- **連鎖イベント**: 一つのイベントが引き起こす連鎖
- **ランダムイベント**: 確率的に発生するイベント

### 3. フラグ管理
- **ワールドフラグ**: 世界状態の管理
- **キャラクターフラグ**: 個別キャラクターの状態
- **クエストフラグ**: クエスト進行状況の管理

## ロケーション時限イベント

### 1. 場所ベースイベント
- **場所固有イベント**: 特定場所でのみ発生
- **移動イベント**: 場所間移動で発生
- **探索イベント**: 場所探索で発見

### 2. 時限要素
- **制限時間**: イベントの有効期限
- **季節イベント**: 特定季節での発生
- **定期イベント**: 一定間隔での反復発生

### 3. 動的場所変化
- **場所状態変化**: イベント結果による場所の変化
- **アクセス性変化**: 新しい場所の開放・封鎖
- **住民変化**: 場所の住民構成の変化

## データ構造

### TRPGEvent基本構造
```typescript
interface TRPGEvent {
  id: string;
  type: EventType;
  title: string;
  description: string;
  scheduledDate: Date;
  duration: number;
  status: EventStatus;
  participants: string[];
  location?: string;
  prerequisites: EventCondition[];
  outcomes: EventOutcome[];
}
```

### イベント条件
```typescript
interface EventCondition {
  type: ConditionType;
  target: string;
  operator: ComparisonOperator;
  value: any;
  description: string;
}
```

### クエスト構造
```typescript
interface QuestInfo {
  id: string;
  parentQuestId?: string;
  title: string;
  description: string;
  status: QuestStatus;
  priority: Priority;
  rewards: Reward[];
  relatedEvents: string[];
}
```

## UI/UX要件

### 1. タイムライン表示
- **横軸タイムライン**: 時間軸での視覚的表示
- **カード表示**: 各イベントの情報カード
- **ドラッグ&ドロップ**: イベントの移動・並び替え
- **ズーム・パン**: 表示範囲の自由な調整

### 2. イベント編集
- **インライン編集**: その場での簡単な修正
- **詳細編集**: 専用ダイアログでの詳細編集
- **一括操作**: 複数イベントの同時編集

### 3. 検索・フィルタ
- **種別フィルタ**: イベント種別による絞り込み
- **日付範囲**: 期間指定での表示
- **キーワード検索**: タイトル・内容での検索
- **状態フィルタ**: 完了・未完了・進行中

## セッション準備機能

### 1. セッション構成
- **イベントリスト**: セッション内のイベント一覧
- **時間配分**: 各イベントの想定時間
- **必要素材**: 準備が必要なリソース一覧
- **チェックリスト**: 準備完了の確認項目

### 2. 準備状況管理
- **準備進捗**: 各項目の準備状況
- **リマインダー**: 期限が近い準備項目の通知
- **共有機能**: プレイヤーへの情報共有

### 3. セッション振り返り
- **実施記録**: 実際に行われたイベントの記録
- **時間記録**: 実際の所要時間
- **評価記録**: イベントの評価・感想
- **改善提案**: 次回への改善点

## エラーハンドリング

### 1. データ整合性
- **日付整合**: 論理的に正しい日付順序
- **依存関係**: クエスト・イベント間の整合性
- **リソース整合**: 必要リソースの存在確認

### 2. スケジュール調整
- **競合検出**: 同時間帯の重複イベント検出
- **自動調整**: 可能な範囲での自動スケジュール調整
- **手動解決**: GM による手動調整支援

## テスト要件

### 1. 機能テスト
- **CRUD操作**: イベント・クエストの基本操作
- **条件システム**: 条件イベントの正常動作
- **AI統合**: AI機能の適切な動作

### 2. ユーザビリティテスト
- **操作性**: ドラッグ&ドロップ等の直感的操作
- **視認性**: 大量データでの可読性
- **効率性**: 日常的な運用での作業効率

### 3. パフォーマンステスト
- **大量イベント**: 多数のイベント管理時の性能
- **リアルタイム更新**: 編集時の応答性
- **検索性能**: フィルタリング・検索の速度