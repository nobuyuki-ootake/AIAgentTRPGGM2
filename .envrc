#!/usr/bin/env bash
# TRPGãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±é€šç’°å¢ƒå¤‰æ•°
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã€ãƒãƒ¼ãƒ é–“ã§å…±æœ‰ã•ã‚Œã¾ã™
# APIã‚­ãƒ¼ãªã©ã®ç§˜å¯†æƒ…å ±ã¯ .env.local ã«è¨˜è¼‰ã—ã¦ãã ã•ã„

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºæœ¬è¨­å®š
export NODE_ENV="development"
export PROJECT_ROOT="$(pwd)"
export PROJECT_NAME="ai-agent-trpg-gm"

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
export DATABASE_PATH="$PROJECT_ROOT/apps/proxy-server/data/trpg.db"
export DATABASE_TYPE="sqlite"

# ã‚µãƒ¼ãƒãƒ¼è¨­å®š
export FRONTEND_PORT="5173"
export BACKEND_PORT="4001"
export FRONTEND_URL="http://localhost:5173"
export BACKEND_URL="http://localhost:4001"

# ãƒ­ã‚°è¨­å®š
export LOG_LEVEL="debug"
export LOG_FILE="$PROJECT_ROOT/dev.log"

# é–‹ç™ºãƒ„ãƒ¼ãƒ«è¨­å®š
export PLAYWRIGHT_BROWSERS_PATH="$PROJECT_ROOT/node_modules/@playwright/browsers"

# TypeScriptè¨­å®š
export TS_NODE_PROJECT="$PROJECT_ROOT/tsconfig.json"

# ç§˜å¯†æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰
# APIã‚­ãƒ¼ã‚„ãã®ä»–ã®æ©Ÿå¯†æƒ…å ±ã¯ .env.local ã«è¨˜è¼‰ã—ã¦ãã ã•ã„
if [[ -f ".env.local" ]]; then
  echo "ğŸ”‘ Loading secrets from .env.local"
  source_env .env.local
else
  echo "âš ï¸  .env.local not found. Please create it with your API keys."
  echo "   Template: cp .env.local.template .env.local"
fi

# é–‹ç™ºè€…å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
echo "ğŸ® TRPG AI Game Master development environment loaded"
echo "ğŸ“‚ Project root: $PROJECT_ROOT"
echo "ğŸ—„ï¸  Database: $DATABASE_PATH"
echo "ğŸŒ Frontend: $FRONTEND_URL"
echo "ğŸ”— Backend: $BACKEND_URL"

# Node.js ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆæ¨å¥¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®è¨­å®šï¼‰
if command -v node >/dev/null 2>&1; then
  NODE_VERSION=$(node --version)
  echo "ğŸ“¦ Node.js version: $NODE_VERSION"
fi

# pnpmç¢ºèª
if command -v pnpm >/dev/null 2>&1; then
  echo "ğŸ“¦ pnpm available: $(pnpm --version)"
else
  echo "âš ï¸  pnpm not installed. Please install: npm install -g pnpm"
fi